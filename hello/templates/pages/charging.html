{% extends 'base.html' %}

{% block content %}
<h2>{{ g.user.name }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</h2>


<div id="map" style="width:75%;height:350px;"></div>
<p id="result"></p>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=efb9f60a7a90695f53ab5c5b69ff2cae"></script>

<h4>ì£¼ì°¨ì¥ ìœ„ì¹˜</h4>
<form id="jsonForm">
    <select class="form-select" id="parkingLot" aria-label="Default select example">
        <option selected>ì£¼ì°¨ì¥ ì„ íƒ</option>
        <option value="ëŒ€êµ¬í…Œí¬ë¹„ì¦ˆì„¼í„°">ğŸ“ƒëŒ€êµ¬í…Œí¬ë¹„ì¦ˆì„¼í„°</option>
        <option value="ì‚¼ì„±ì°½ì¡°ìº í¼ìŠ¤">ğŸ§‘â€ğŸ¨ì‚¼ì„±ì°½ì¡°ìº í¼ìŠ¤</option>
        <option value="3">---ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤---</option>
    </select>

    <div>
        <h4>ì£¼ì°¨ ìœ„ì¹˜</h4>

        <!-- Button trigger modal -->
        <!-- ëª¨ë‹¬ì„ ì‹¤í–‰í•  ë²„íŠ¼ -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            ì£¼ì°¨ ìœ„ì¹˜ ì„ íƒ
        </button>

        <!-- ëª¨ë‹¬ -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">ì£¼ì°¨ ìœ„ì¹˜ ì„ íƒ</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="box" data-value="1ë²ˆ">1</div>
                        <div class="box" data-value="2ë²ˆ">2</div>
                        <div class="box" data-value="3ë²ˆ">3</div>
                        <div class="box" data-value="4ë²ˆ">4</div>
                        <div class="box" data-value="5ë²ˆ">5</div>
                        <div class="box" data-value="6ë²ˆ">6</div>
                        <div class="box" data-value="7ë²ˆ">7</div>
                        <div class="box" data-value="8ë²ˆ">8</div>
                        <div class="box" data-value="9ë²ˆ">9</div>
                        <div class="box" data-value="10ë²ˆ">10</div>
                        <div class="box" data-value="11ë²ˆ">11</div>
                        <div class="box" data-value="12ë²ˆ">12</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                        <button type="button" class="btn btn-primary">ì„ íƒí•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div>

        <h4 id="res">ì„ íƒëœ ì£¼ì°¨ ìœ„ì¹˜: </h4>
    </div>
    <div>
        <h4>ì°¨ì¢…</h4>
        <select id="model" class="form-select" aria-label="Default select example">
            <option selected value="../../static/images/car.png">ì°¨ì¢… ì„ íƒ</option>
            <option value="../../static/images/spider.jpg">í˜„ëŒ€ ì•„ì´ì˜¤ë‹‰5</option>
            <option value="2">ì œë„¤ì‹œìŠ¤ GV60</option>
            <option value="3">ê¸°ì•„ EV6</option>
            <option value="../../static/TeslaModel3.png">í…ŒìŠ¬ë¼ ëª¨ë¸ 3</option>
            <option value="5">í…ŒìŠ¬ë¼ ëª¨ë¸ Y</option>
            <option value="6">ìì „ê±°</option>
        </select>
        <img id="myImg" src="../../static/images/spider.jpg"/>
    </div>
    <a href=" {{ url_for('main.index') }} ">
    <button type="submit" class="btn btn-primary">ì¶©ì „ ë“±ë¡ !</button>
    </a>
</form>

<script>
    <!-- ì°¨ì¢… ì„ íƒ ì´ë¯¸ì§€ js-->
    let changeimg = document.getElementById("model");
    let myImg = document.getElementById("myImg");

    function changeImage(){
        let index = changeimg.selectedIndex;
        myImg.src = changeimg.options[index].value;
    }
    changeImage();
    changeimg.onchange = changeImage;

    <!-- ì£¼ì°¨ ìœ„ì¹˜ ì„ íƒ js test-->
        var options = document.getElementsByClassName('box');
    for (var i = 0; i < options.length; i++) {
        options[i].onclick = function() {
            var selectedValue = this.getAttribute('data-value');
            document.getElementById('res').innerText = 'ì£¼ì°¨ ìœ„ì¹˜: ' + selectedValue;
            modal.style.display = "none";
        }
    }

    <!--json POST-->
    document.getElementById('jsonForm').addEventListener('submit', function(event){
        event.preventDefault();
        var name = '{{ g.user.name }}';
        var parking = document.getElementById('parkingLot').value;

        var str = document.getElementById('res').innerText;
        const regex = /[^0-9]/g;
        var position = str.replace(regex,"")

        var selectElement = document.getElementById("model");
        var model = selectElement.options[selectElement.selectedIndex].text;
        console.log(parking);
        var data = {
            name: name,
            parking: parking,
            position: position,
            model: model
        };

        fetch('/car/charging', {
            method: 'POST',
             headers: {
            'Content-Type': 'application/json'
  },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:',data);
            alert('Data submitted successfully!');
            <!-- window.location.href = 'http://127.0.0.1:5000'; -->
            window.history.go(-1);
        })
        .catch((error) => {
            console.log('Error:', error);
        });
    });

</script>

{% endblock %}